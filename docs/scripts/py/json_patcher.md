# json_reading_patcher.py

## Overview

`json_reading_patcher.py` modifies DDS Publisher applications to read data from JSON scenario files instead of using hardcoded values. It replaces the AUTOGENERATED IDL PATCH blocks with JSON file reading logic.

## Purpose

- Replaces hardcoded data assignments with JSON file reading
- Enables scenario-based data injection for publishers
- Maintains compatibility with IDL patcher output
- Supports multiple IDL modules (CoreData, Intelligence, Messaging, etc.)

## How It Works

1. **File Discovery**: Finds all `*PublisherApp.cxx` files in `IDL/*_idl_generated/` directories
2. **JSON Matching**: Matches each publisher with corresponding JSON file in `scenarios/` directory
3. **Code Replacement**: Replaces AUTOGENERATED IDL PATCH blocks with JSON reading code
4. **Backup Creation**: Creates backup files before modification

## Usage

### Basic Usage

```bash
cd scripts/py
python3 json_reading_patcher.py
```

### From Project Root

```bash
python3 scripts/py/json_reading_patcher.py
```

### Via Shell Script

```bash
bash scripts/sh/patch_json_reading.sh
```

## Execution Order

**Important**: JSON patcher must be run **after** IDL patcher:

1. First: `idl_default_data_patcher.py` - Creates AUTOGENERATED blocks with default data
2. Then: `json_reading_patcher.py` - Replaces blocks with JSON reading logic

## JSON File Format

JSON files should be located in `scenarios/` directory and named after the module:
- `scenarios/CoreData.json`
- `scenarios/Intelligence.json`
- `scenarios/Messaging.json`

Example JSON structure:
```json
[
  {
    "latitude": 39.9334,
    "longitude": 32.8597,
    "altitude": 1500.0,
    "speed_mps": 250.5
  },
  {
    "latitude": 40.1234,
    "longitude": 33.5678,
    "altitude": 1600.0,
    "speed_mps": 260.0
  }
]
```

## Generated Code

Replaces hardcoded assignments with:
```cpp
// JSON file reading code
std::ifstream json_file("scenarios/ModuleName.json");
// ... JSON parsing and data assignment ...
```

## Output Files

- Modified `*PublisherApp.cxx` files
- Backup files with `.json_patcher_backup` suffix

## Requirements

- Python 3.x
- nlohmann/json library (included in project)
- JSON files in `scenarios/` directory

## Integration

This script is called by:
- `init/sh/project_setup.sh` - During patching phase
- `scripts/sh/patch_json_reading.sh` - Standalone execution
- `scripts/sh/run_complete_workflow.sh` - Complete workflow

## Notes

- Only processes files that have AUTOGENERATED IDL PATCH blocks
- Creates backups before modification
- Skips files if corresponding JSON file doesn't exist
- Idempotent: safe to run multiple times

